<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUBG AR - P2P ë°°í‹€ë¡œì–„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        color: white;
        overflow: hidden;
        height: 100vh;
        user-select: none;
    }

    .game-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .lobby {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        text-align: center;
        padding: 20px;
    }

    .lobby h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 0 0 20px #00ff41;
    }

    .lobby p {
        font-size: 1.1rem;
        opacity: 0.8;
        margin-bottom: 30px;
    }

    .name-display {
        font-size: 1.3rem;
        color: #00ff41;
        margin: 20px 0;
        padding: 15px;
        background: rgba(0, 255, 65, 0.1);
        border: 2px solid #00ff41;
        border-radius: 10px;
        min-width: 200px;
    }

    .room-code-display {
        font-size: 1.1rem;
        color: #ffaa00;
        margin: 15px 0;
        padding: 10px;
        background: rgba(255, 170, 0, 0.1);
        border: 2px solid #ffaa00;
        border-radius: 8px;
    }

    .btn-group {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
    }

    .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        min-width: 200px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        color: white;
        border: 2px solid #ff4444;
    }

    .btn-secondary {
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
        color: white;
        border: 2px solid #00ff41;
    }

    .btn-info {
        background: linear-gradient(135deg, #ffa726, #ffcc02);
        color: #333;
        border: 2px solid #ffaa00;
    }

    .btn:active {
        transform: scale(0.95);
    }

    .btn:hover {
        filter: brightness(1.1);
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .game-screen {
        flex: 1;
        position: relative;
        background: radial-gradient(circle at center, #0f3460, #16537e, #1a1a2e);
    }

    .hud {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .hud-panel {
        background: rgba(0, 0, 0, 0.8);
        padding: 12px;
        border-radius: 10px;
        border: 2px solid #00ff41;
        backdrop-filter: blur(5px);
    }

    .health-bar {
        width: 120px;
        height: 8px;
        background: #333;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
    }

    .health-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff4444, #ffaa00, #00ff41);
        transition: width 0.5s;
    }

    .crosshair {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        z-index: 50;
        pointer-events: none;
    }

    .crosshair::before,
    .crosshair::after {
        content: '';
        position: absolute;
        background: #00ff41;
        box-shadow: 0 0 15px #00ff41;
        border-radius: 2px;
    }

    .crosshair::before {
        width: 3px;
        height: 25px;
        top: 12px;
        left: 23px;
    }

    .crosshair::after {
        width: 25px;
        height: 3px;
        top: 23px;
        left: 12px;
    }

    .controls {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
        z-index: 100;
    }

    .shoot-btn {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: radial-gradient(circle, #ff4444, #aa0000);
        border: 3px solid #ff6666;
        color: white;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.1s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
    }

    .shoot-btn:active {
        transform: scale(0.9);
        box-shadow: 0 0 30px rgba(255, 68, 68, 0.8);
    }

    .player-radar {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 100px;
        height: 100px;
        background: rgba(0, 0, 0, 0.8);
        border: 2px solid #00ff41;
        border-radius: 50%;
        z-index: 90;
    }

    .player-list {
        position: absolute;
        top: 140px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        padding: 15px;
        border-radius: 10px;
        border: 2px solid #00ff41;
        max-height: 200px;
        min-width: 180px;
        overflow-y: auto;
    }

    .player-item {
        padding: 8px 0;
        border-bottom: 1px solid #333;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
    }

    .player-item:last-child {
        border-bottom: none;
    }

    .distance-display {
        position: absolute;
        bottom: 140px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        padding: 12px 20px;
        border-radius: 20px;
        border: 2px solid #00ff41;
        font-size: 18px;
        font-weight: bold;
    }

    .status-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 200;
    }

    .status-modal {
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        padding: 30px;
        border-radius: 15px;
        border: 3px solid #00ff41;
        text-align: center;
        max-width: 300px;
        width: 90%;
    }

    .status-modal h3 {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #00ff41;
    }

    .hidden {
        display: none !important;
    }

    .hit-effect {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(circle, rgba(255, 0, 0, 0.3), transparent);
        pointer-events: none;
        animation: hitFlash 0.5s ease-out;
        z-index: 150;
    }

    @keyframes hitFlash {
        0% { opacity: 0; }
        50% { opacity: 1; }
        100% { opacity: 0; }
    }

    .connection-status {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 15px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 20px;
        font-size: 12px;
        z-index: 110;
    }

    .connected { border: 2px solid #00ff41; color: #00ff41; }
    .connecting { border: 2px solid #ffaa00; color: #ffaa00; }
    .disconnected { border: 2px solid #ff4444; color: #ff4444; }

    .radar-dot {
        position: absolute;
        width: 6px;
        height: 6px;
        background: #ff4444;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 8px #ff4444;
    }

    .ping-display {
        position: absolute;
        bottom: 10px;
        right: 10px;
        padding: 5px 10px;
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid #00ff41;
        border-radius: 5px;
        font-size: 12px;
    }

    @keyframes hitMarkerFade {
        0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(1.2) translateY(-20px); }
    }

    @media (max-width: 480px) {
        .lobby h1 { font-size: 2rem; }
        .btn { font-size: 14px; padding: 12px 25px; }
        .hud { left: 10px; right: 10px; top: 10px; }
        .controls { bottom: 20px; }
    }
</style>
```

</head>
<body>
    <div class="game-container">
        <!-- ë¡œë¹„ í™”ë©´ -->
        <div id="lobbyScreen" class="lobby">
            <h1>ğŸ¯ PUBG AR</h1>
            <p>ì‹¤ì‹œê°„ P2P ë°°í‹€ë¡œì–„</p>

```
        <div class="name-display">
            <div>ğŸ® <span id="playerNameDisplay"></span></div>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="createRoom()">
                ğŸ  ë°© ë§Œë“¤ê¸°
            </button>
            <button class="btn btn-secondary" onclick="showJoinRoom()">
                ğŸšª ë°© ì°¸ê°€í•˜ê¸°
            </button>
            <button class="btn btn-info" onclick="generateNewName()">
                ğŸ² ë‹‰ë„¤ì„ ë³€ê²½
            </button>
        </div>
        
        <div style="margin-top: 30px; font-size: 13px; opacity: 0.7; line-height: 1.4;">
            <p>ğŸ“± ìŠ¤ë§ˆíŠ¸í°ì„ ì´ì²˜ëŸ¼ ë“¤ê³  ì¡°ì¤€</p>
            <p>ğŸ¯ ë¹¨ê°„ ë²„íŠ¼ìœ¼ë¡œ ë°œì‚¬!</p>
            <p>âš¡ ì‹¤ì‹œê°„ ë©€í‹°í”Œë ˆì´</p>
        </div>
    </div>

    <!-- ë°© ì°¸ê°€ í™”ë©´ -->
    <div id="joinRoomScreen" class="lobby hidden">
        <h2>ğŸšª ë°© ì°¸ê°€</h2>
        <p>ì¹œêµ¬ê°€ ì¤€ ë°© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
        
        <div style="margin: 30px 0;">
            <input type="text" id="roomCodeInput" 
                   style="padding: 15px; font-size: 18px; border: 2px solid #00ff41; border-radius: 8px; background: rgba(0,0,0,0.7); color: white; text-align: center; width: 200px;"
                   placeholder="ë°© ì½”ë“œ ì…ë ¥" maxlength="6">
        </div>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="joinRoom()">
                âœ… ì°¸ê°€í•˜ê¸°
            </button>
            <button class="btn btn-secondary" onclick="backToLobby()">
                â† ë’¤ë¡œê°€ê¸°
            </button>
        </div>
    </div>

    <!-- ë°© ëŒ€ê¸° í™”ë©´ -->
    <div id="waitingScreen" class="lobby hidden">
        <h2>ğŸ  ë°© ëŒ€ê¸°ì‹¤</h2>
        <div class="room-code-display">
            ë°© ì½”ë“œ: <strong id="roomCodeDisplay"></strong>
        </div>
        <p>ì¹œêµ¬ë“¤ì—ê²Œ ìœ„ ì½”ë“œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!</p>
        
        <div id="waitingPlayers" style="margin: 30px 0;">
            <h3>ì°¸ê°€ì ëª©ë¡</h3>
            <div id="playersList"></div>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-primary" onclick="startGame()" id="startGameBtn" disabled>
                ğŸš€ ê²Œì„ ì‹œì‘ (2ëª… ì´ìƒ)
            </button>
            <button class="btn btn-secondary" onclick="leaveRoom()">
                ğŸšª ë°© ë‚˜ê°€ê¸°
            </button>
        </div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen" class="game-screen hidden">
        <div class="connection-status connecting" id="connectionStatus">
            ì—°ê²° ì¤‘...
        </div>
        
        <div class="hud">
            <div class="hud-panel">
                <div>â¤ï¸ <span id="healthDisplay">100</span>/100</div>
                <div class="health-bar">
                    <div class="health-fill" id="healthBar" style="width: 100%;"></div>
                </div>
                <div>ğŸ† í‚¬: <span id="killDisplay">0</span></div>
                <div>ğŸ“‹ íƒ„ì•½: <span id="ammoDisplay">30</span>/30</div>
            </div>
            
            <div class="hud-panel">
                <div>ğŸ‘¥ ìƒì¡´: <span id="aliveDisplay">0</span></div>
                <div>ğŸ“¡ ê±°ë¦¬: <span id="nearestDistance">-</span>m</div>
                <div>ğŸ”— ì—°ê²°: <span id="connectedCount">0</span></div>
            </div>
        </div>

        <div class="crosshair"></div>
        
        <div class="player-radar" id="radar">
            <!-- ë ˆì´ë” ì ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
        </div>

        <div class="player-list">
            <h4 style="margin-bottom: 10px;">í”Œë ˆì´ì–´</h4>
            <div id="gamePlayersList"></div>
        </div>

        <div class="distance-display" id="distanceInfo">
            ì¡°ì¤€ ì¤‘: <span id="targetName">-</span>
        </div>

        <div class="ping-display" id="pingDisplay">
            í•‘: <span id="pingValue">-</span>ms
        </div>

        <div class="controls">
            <button class="btn btn-secondary" onclick="leaveGame()" style="font-size: 12px; padding: 8px 15px;">
                ğŸšª ë‚˜ê°€ê¸°
            </button>
            
            <button class="shoot-btn" id="shootButton" 
                    onmousedown="startShooting()" onmouseup="stopShooting()"
                    ontouchstart="startShooting(event)" ontouchend="stopShooting(event)">
                ğŸ”«
            </button>
            
            <button class="btn btn-secondary" onclick="reload()" style="font-size: 12px; padding: 8px 15px;">
                ğŸ”„ ì¬ì¥ì „
            </button>
        </div>
    </div>

    <!-- ìƒíƒœ ë©”ì‹œì§€ ëª¨ë‹¬ -->
    <div id="statusOverlay" class="status-overlay hidden">
        <div class="status-modal">
            <h3 id="statusTitle"></h3>
            <p id="statusMessage"></p>
            <button class="btn btn-primary" onclick="closeStatus()" style="margin-top: 15px;">
                í™•ì¸
            </button>
        </div>
    </div>
</div>

<script>
    // ê²Œì„ ìƒíƒœ ê´€ë¦¬
    let gameState = {
        screen: 'lobby',
        playerId: '',
        playerName: '',
        roomCode: '',
        isHost: false,
        health: 100,
        kills: 0,
        ammo: 30,
        maxAmmo: 30,
        isReloading: false,
        position: { lat: 0, lng: 0, accuracy: 0 },
        orientation: { alpha: 0, beta: 0, gamma: 0 },
        players: new Map(),
        connections: new Map(),
        lastShot: 0,
        gameStartTime: 0,
        signaling: null,
        gameLoop: null,
        pingInterval: null
    };

    // WebSocket ì‹œê·¸ë„ë§ ì„œë²„ (ë¬´ë£Œ WebSocket ì„œë¹„ìŠ¤ ì‚¬ìš©)
    const SIGNALING_SERVER = 'wss://ws.postman-echo.com/raw';

    // ICE ì„œë²„ ì„¤ì • (ë¬´ë£Œ STUN ì„œë²„)
    const rtcConfig = {
        iceServers: [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:stun1.l.google.com:19302' },
            { urls: 'stun:stun.services.mozilla.com' },
            { urls: 'stun:stun.stunprotocol.org:3478' }
        ]
    };

    // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
    const adjectives = ['ìš©ê°í•œ', 'ë¹ ë¥¸', 'ê°•ë ¥í•œ', 'ë˜‘ë˜‘í•œ', 'ì‹ ë¹„í•œ', 'ì°¨ê°€ìš´', 'ëœ¨ê±°ìš´', 'ë‚ ì¹´ë¡œìš´', 'ì¡°ìš©í•œ', 'ê±°ëŒ€í•œ'];
    const nouns = ['ì „ì‚¬', 'ì‚¬ëƒ¥ê¾¼', 'ì €ê²©ìˆ˜', 'íŠ¹ê³µëŒ€', 'ìš©ë³‘', 'ë‹Œì', 'í•´ì ', 'ê¸°ì‚¬', 'ë§ˆë²•ì‚¬', 'ë¡œë´‡'];

    function generateRandomName() {
        const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
        const noun = nouns[Math.floor(Math.random() * nouns.length)];
        const num = Math.floor(Math.random() * 1000);
        return `${adj}${noun}${num}`;
    }

    // ê³ ìœ  í”Œë ˆì´ì–´ ID ìƒì„±
    function generatePlayerId() {
        return Math.random().toString(36).substring(2, 15) + Date.now().toString(36);
    }

    // ì´ˆê¸°í™”
    function init() {
        gameState.playerId = generatePlayerId();
        gameState.playerName = generateRandomName();
        document.getElementById('playerNameDisplay').textContent = gameState.playerName;
        
        // ìœ„ì¹˜ ì •ë³´ ê¶Œí•œ ìš”ì²­
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(updatePosition, handleLocationError, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            });
        } else {
            handleLocationError({ message: 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤' });
        }
        
        // ë””ë°”ì´ìŠ¤ ë°©í–¥ ê¶Œí•œ ìš”ì²­
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission().then(response => {
                if (response === 'granted') {
                    window.addEventListener('deviceorientation', updateOrientation);
                }
            });
        } else {
            window.addEventListener('deviceorientation', updateOrientation);
        }
        
        // í„°ì¹˜ ì´ë²¤íŠ¸ ë°©ì§€ (ê²Œì„ ì¤‘ ìŠ¤í¬ë¡¤ ë°©ì§€)
        document.addEventListener('touchmove', function(e) {
            if (gameState.screen === 'game') {
                e.preventDefault();
            }
        }, { passive: false });

        // ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²° (ë°©ì´ ìˆì„ ë•Œë§Œ)
        // connectSignaling();
    }

    // ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²°
    function connectSignaling() {
        try {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì ì ˆí•œ WebSocket ì„œë²„ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤
            // ì—¬ê¸°ì„œëŠ” Firebase Realtime Databaseë‚˜ Socket.io ì„œë²„ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤
            gameState.signaling = new WebSocket('wss://echo.websocket.org');
            
            gameState.signaling.onopen = () => {
                console.log('ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²°ë¨');
                updateConnectionStatus('connected');
            };

            gameState.signaling.onmessage = (event) => {
                handleSignalingMessage(JSON.parse(event.data));
            };

            gameState.signaling.onerror = (error) => {
                console.error('ì‹œê·¸ë„ë§ ì˜¤ë¥˜:', error);
                updateConnectionStatus('disconnected');
            };

            gameState.signaling.onclose = () => {
                console.log('ì‹œê·¸ë„ë§ ì—°ê²° ì¢…ë£Œ');
                updateConnectionStatus('disconnected');
                
                // ì¬ì—°ê²° ì‹œë„
                setTimeout(connectSignaling, 3000);
            };

        } catch (error) {
            console.error('ì‹œê·¸ë„ë§ ì—°ê²° ì‹¤íŒ¨:', error);
            // ë°ëª¨ìš©ìœ¼ë¡œ ë¡œì»¬ ì—°ê²° ì‹œë®¬ë ˆì´ì…˜
            simulateLocalConnection();
        }
    }

    // ë¡œì»¬ ì—°ê²° ì‹œë®¬ë ˆì´ì…˜ (ì‹œê·¸ë„ë§ ì„œë²„ ì—†ì´ í…ŒìŠ¤íŠ¸ìš©)
    function simulateLocalConnection() {
        setTimeout(() => {
            updateConnectionStatus('connected');
        }, 1000);
    }

    // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì²˜ë¦¬
    function handleSignalingMessage(message) {
        console.log('ì‹œê·¸ë„ë§ ë©”ì‹œì§€:', message);
        
        if (message.roomCode !== gameState.roomCode) return;

        switch (message.type) {
            case 'join-room':
                handlePlayerJoin(message);
                break;
            case 'offer':
                handleOffer(message);
                break;
            case 'answer':
                handleAnswer(message);
                break;
            case 'ice-candidate':
                handleIceCandidate(message);
                break;
            case 'leave-room':
                handlePlayerLeave(message);
                break;
            case 'start-game':
                handleGameStart(message);
                break;
        }
    }

    function updatePosition(position) {
        gameState.position = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            accuracy: position.coords.accuracy
        };
        broadcastPosition();
    }

    function handleLocationError(error) {
        console.log('ìœ„ì¹˜ ì •ë³´ ì˜¤ë¥˜:', error.message);
        // ì„œìš¸ ì¤‘ì‹¬ë¶€ ê·¼ì²˜ì˜ ëœë¤ ìœ„ì¹˜ ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)
        gameState.position = {
            lat: 37.5665 + (Math.random() - 0.5) * 0.01,
            lng: 126.9780 + (Math.random() - 0.5) * 0.01,
            accuracy: 10
        };
    }

    function updateOrientation(event) {
        gameState.orientation = {
            alpha: event.alpha || 0,
            beta: event.beta || 0,
            gamma: event.gamma || 0
        };
    }

    // í™”ë©´ ì „í™˜
    function showScreen(screenName) {
        document.querySelectorAll('.lobby, .game-screen').forEach(el => el.classList.add('hidden'));
        
        switch(screenName) {
            case 'lobby':
                document.getElementById('lobbyScreen').classList.remove('hidden');
                break;
            case 'joinRoom':
                document.getElementById('joinRoomScreen').classList.remove('hidden');
                break;
            case 'waiting':
                document.getElementById('waitingScreen').classList.remove('hidden');
                break;
            case 'game':
                document.getElementById('gameScreen').classList.remove('hidden');
                break;
        }
        
        gameState.screen = screenName;
    }

    // ë‹‰ë„¤ì„ ì¬ìƒì„±
    function generateNewName() {
        gameState.playerName = generateRandomName();
        document.getElementById('playerNameDisplay').textContent = gameState.playerName;
    }

    // ë°© ë§Œë“¤ê¸°
    function createRoom() {
        gameState.roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
        gameState.isHost = true;
        
        document.getElementById('roomCodeDisplay').textContent = gameState.roomCode;
        showScreen('waiting');
        
        // ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²°
        connectSignaling();
        
        // ë°©ì¥ì€ ìì‹ ì„ í”Œë ˆì´ì–´ ëª©ë¡ì— ì¶”ê°€
        const hostPlayer = {
            id: gameState.playerId,
            name: gameState.playerName,
            isHost: true
        };
        updatePlayersList([hostPlayer]);

        // ë°© ì •ë³´ë¥¼ ì‹œê·¸ë„ë§ ì„œë²„ì— ì „ì†¡
        setTimeout(() => {
            sendSignalingMessage({
                type: 'create-room',
                roomCode: gameState.roomCode,
                playerId: gameState.playerId,
                playerName: gameState.playerName
            });
        }, 1000);
    }

    // ë°© ì°¸ê°€ í™”ë©´ í‘œì‹œ
    function showJoinRoom() {
        showScreen('joinRoom');
        document.getElementById('roomCodeInput').focus();
    }

    // ë°© ì°¸ê°€
    function joinRoom() {
        const roomCode = document.getElementById('roomCodeInput').value.toUpperCase();
        if (roomCode.length !== 6) {
            showStatus('ì˜¤ë¥˜', 'ë°© ì½”ë“œëŠ” 6ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.');
            return;
        }
        
        gameState.roomCode = roomCode;
        gameState.isHost = false;
        
        document.getElementById('roomCodeDisplay').textContent = roomCode;
        showScreen('waiting');
        
        // ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²°
        connectSignaling();
        
        // ë°© ì°¸ê°€ ìš”ì²­
        setTimeout(() => {
            sendSignalingMessage({
                type: 'join-room',
                roomCode: gameState.roomCode,
                playerId: gameState.playerId,
                playerName: gameState.playerName
            });
        }, 1000);

        // ë°ëª¨ìš© í”Œë ˆì´ì–´ ì¶”ê°€
        setTimeout(() => {
            updatePlayersList([
                { id: 'host', name: 'ë°©ì¥', isHost: true },
                { id: gameState.playerId, name: gameState.playerName, isHost: false }
            ]);
        }, 2000);
    }

    // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì „ì†¡
    function sendSignalingMessage(message) {
        if (gameState.signaling && gameState.signaling.readyState === WebSocket.OPEN) {
            gameState.signaling.send(JSON.stringify(message));
        } else {
            console.log('ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²°ë˜ì§€ ì•ŠìŒ, ë©”ì‹œì§€ ë¬´ì‹œ:', message);
        }
    }

    // WebRTC ì—°ê²° ìƒì„±
    function createPeerConnection(peerId) {
        const peerConnection = new RTCPeerConnection(rtcConfig);
        
        // ë°ì´í„° ì±„ë„ ìƒì„±
        const dataChannel = peerConnection.createDataChannel('game', {
            ordered: false,
            maxRetransmits: 3
        });
        
        dataChannel.onopen = () => {
            console.log(`${peerId}ì™€ ì—°ê²°ë¨`);
            updateConnectionStatus('connected');
            updateConnectedCount();
        };
        
        dataChannel.onclose = () => {
            console.log(`${peerId} ì—°ê²° ëŠì–´ì§`);
            gameState.players.delete(peerId);
            updateConnectedCount();
            updateGameUI();
        };
        
        dataChannel.onmessage = (event) => {
            handlePeerMessage(JSON.parse(event.data), peerId);
        };
        
        dataChannel.onerror = (error) => {
            console.error(`${peerId} ë°ì´í„° ì±„ë„ ì˜¤ë¥˜:`, error);
            updateConnectionStatus('disconnected');
        };
        
        // ICE í›„ë³´ ì²˜ë¦¬
        peerConnection.onicecandidate = (event) => {
            if (event.candidate) {
                sendSignalingMessage({
                    type: 'ice-candidate',
                    roomCode: gameState.roomCode,
                    targetId: peerId,
                    senderId: gameState.playerId,
                    candidate: event.candidate
                });
            }
        };
        
        // ì›ê²© ë°ì´í„° ì±„ë„ ì²˜ë¦¬
        peerConnection.ondatachannel = (event) => {
            const channel = event.channel;
            channel.onmessage = (event) => {
                handlePeerMessage(JSON.parse(event.data), peerId);
            };
            channel.onopen = () => {
                console.log(`${peerId}ë¡œë¶€í„° ë°ì´í„° ì±„ë„ ì—°ê²°ë¨`);
                updateConnectedCount();
            };
        };
        
        gameState.connections.set(peerId, { peerConnection, dataChannel });
        return peerConnection;
    }

    // í”¼ì–´ ë©”ì‹œì§€ ì²˜ë¦¬
    function handlePeerMessage(message, peerId) {
        const now = Date.now();
        
        switch (message.type) {
            case 'position':
                updatePlayerPosition(message.data, peerId);
                break;
            case 'shot':
                handlePeerShot(message.data, peerId);
                break;
            case 'hit':
                handlePeerHit(message.data);
                break;
            case 'death':
                handlePlayerDeath(message.data, peerId);
                break;
            case 'ping':
                sendPeerMessage(peerId, {
                    type: 'pong',
                    timestamp: message.timestamp
                });
                break;
            case 'pong':
                updatePing(now - message.timestamp);
                break;
        }
    }

    // í”¼ì–´ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡
    function sendPeerMessage(peerId, message) {
        const connection = gameState.connections.get(peerId);
        if (connection && connection.dataChannel && connection.dataChannel.readyState === 'open') {
            try {
                connection.dataChannel.send(JSON.stringify(message));
            } catch (error) {
                console.error(`${peerId}ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:`, error);
            }
        }
    }

    // ëª¨ë“  í”¼ì–´ì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
    function broadcastMessage(message) {
        gameState.connections.forEach((connection, peerId) => {
            sendPeerMessage(peerId, message);
        });
    }

    // í”Œë ˆì´ì–´ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    function updatePlayerPosition(data, peerId) {
        const existingPlayer = gameState.players.get(peerId) || {};
        gameState.players.set(peerId, {
            ...existingPlayer,
            id: peerId,
            name: data.playerName || existingPlayer.name || 'ì•Œ ìˆ˜ ì—†ìŒ',
            position: data.position,
            orientation: data.orientation,
            health: data.health !== undefined ? data.health : existingPlayer.health || 100,
            lastSeen: Date.now()
        });
    }

    // ìœ„ì¹˜ ì •ë³´ ë¸Œë¡œë“œìºìŠ¤íŠ¸
    function broadcastPosition() {
        if (gameState.screen === 'game') {
            broadcastMessage({
                type: 'position',
                data: {
                    playerName: gameState.playerName,
                    position: gameState.position,
                    orientation: gameState.orientation,
                    health: gameState.health,
                    timestamp: Date.now()
                }
            });
        }
    }

    // ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°
    function backToLobby() {
        showScreen('lobby');
    }

    // ë°© ë‚˜ê°€ê¸°
    function leaveRoom() {
        // P2P ì—°ê²° ì •ë¦¬
        gameState.connections.forEach((connection, peerId) => {
            if (connection.peerConnection) {
                connection.peerConnection.close();
            }
        });
        gameState.connections.clear();
        gameState.players.clear();
        
        // ì‹œê·¸ë„ë§ ì„œë²„ì— ë‚˜ê°€ê¸° ì•Œë¦¼
        sendSignalingMessage({
            type: 'leave-room',
            roomCode: gameState.roomCode,
            playerId: gameState.playerId
        });
        
        // ì‹œê·¸ë„ë§ ì—°ê²° ì¢…ë£Œ
        if (gameState.signaling) {
            gameState.signaling.close();
            gameState.signaling = null;
        }
        
        showScreen('lobby');
    }

    // í”Œë ˆì´ì–´ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updatePlayersList(players) {
        const container = document.getElementById('playersList');
        container.innerHTML = '';
        
        players.forEach(player => {
            const playerDiv = document.createElement('div');
            playerDiv.style.cssText = 'padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 5px; display: flex; justify-content: space-between; align-items: center;';
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = player.name;
            
            const statusSpan = document.createElement('span');
            statusSpan.textContent = player.isHost ? 'ğŸ‘‘' : 'ğŸ®';
            statusSpan.style.fontSize = '16px';
            
            playerDiv.appendChild(nameSpan);
            playerDiv.appendChild(statusSpan);
            container.appendChild(playerDiv);
        });
        
        // ì‹œì‘ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        const startBtn = document.getElementById('startGameBtn');
        if (players.length >= 2 && gameState.isHost) {
            startBtn.disabled = false;
            startBtn.style.opacity = '1';
        } else {
            startBtn.disabled = true;
            startBtn.style.opacity = '0.5';
        }
    }

    // ê²Œì„ ì‹œì‘
    function startGame() {
        if (gameState.screen !== 'waiting' || !gameState.isHost) return;
        
        // ëª¨ë“  í”Œë ˆì´ì–´ì—ê²Œ ê²Œì„ ì‹œì‘ ì•Œë¦¼
        sendSignalingMessage({
            type: 'start-game',
            roomCode: gameState.roomCode,
            playerId: gameState.playerId
        });
        
        // ê²Œì„ ì´ˆê¸°í™”
        initializeGame();
    }

    // ê²Œì„ ì´ˆê¸°í™”
    function initializeGame() {
        gameState.gameStartTime = Date.now();
        gameState.health = 100;
        gameState.kills = 0;
        gameState.ammo = gameState.maxAmmo;
        gameState.isReloading = false;
        
        showScreen('game');
        updateGameUI();
        startGameLoop();
        startPingCheck();
    }

    // ê²Œì„ ë£¨í”„ ì‹œì‘
    function startGameLoop() {
        gameState.gameLoop = setInterval(() => {
            updateGameUI();
            updateRadar();
            broadcastPosition();
            
            // ì˜¤ë˜ëœ í”Œë ˆì´ì–´ ì •ë¦¬ (30ì´ˆ ì´ìƒ ì‘ë‹µ ì—†ìŒ)
            const now = Date.now();
            gameState.players.forEach((player, playerId) => {
                if (now - player.lastSeen > 30000) {
                    gameState.players.delete(playerId);
                    const connection = gameState.connections.get(playerId);
                    if (connection) {
                        connection.peerConnection.close();
                        gameState.connections.delete(playerId);
                    }
                }
            });
            
            updateConnectedCount();
            
        }, 1000);
    }

    // í•‘ ì²´í¬ ì‹œì‘
    function startPingCheck() {
        gameState.pingInterval = setInterval(() => {
            gameState.connections.forEach((connection, peerId) => {
                if (connection.dataChannel && connection.dataChannel.readyState === 'open') {
                    sendPeerMessage(peerId, {
                        type: 'ping',
                        timestamp: Date.now()
                    });
                }
            });
        }, 5000);
    }

    // í•‘ ì—…ë°ì´íŠ¸
    function updatePing(pingTime) {
        document.getElementById('pingValue').textContent = Math.round(pingTime);
    }

    // ì—°ê²°ëœ í”Œë ˆì´ì–´ ìˆ˜ ì—…ë°ì´íŠ¸
    function updateConnectedCount() {
        let connectedCount = 0;
        gameState.connections.forEach(connection => {
            if (connection.dataChannel && connection.dataChannel.readyState === 'open') {
                connectedCount++;
            }
        });
        document.getElementById('connectedCount').textContent = connectedCount;
    }

    // ê²Œì„ UI ì—…ë°ì´íŠ¸
    function updateGameUI() {
        document.getElementById('healthDisplay').textContent = gameState.health;
        document.getElementById('healthBar').style.width = gameState.health + '%';
        document.getElementById('killDisplay').textContent = gameState.kills;
        document.getElementById('aliveDisplay').textContent = gameState.players.size + 1;
        document.getElementById('ammoDisplay').textContent = gameState.ammo;
        
        // í”Œë ˆì´ì–´ ëª©ë¡ ì—…ë°ì´íŠ¸
        const gamePlayersList = document.getElementById('gamePlayersList');
        gamePlayersList.innerHTML = '';
        
        let nearestDistance = Infinity;
        let nearestPlayer = null;
        
        gameState.players.forEach(player => {
            const distance = calculateDistance(gameState.position, player.position);
            
            if (distance < nearestDistance && player.health > 0) {
                nearestDistance = distance;
                nearestPlayer = player;
            }
            
            const playerItem = document.createElement('div');
            playerItem.className = 'player-item';
            
            const healthColor = player.health > 50 ? '#00ff41' : player.health > 20 ? '#ffaa00' : '#ff4444';
            
            playerItem.innerHTML = `
                <span style="color: ${player.health > 0 ? 'white' : '#666'}">
                    ${player.name} ${player.health <= 0 ? 'ğŸ’€' : ''}
                </span>
                <span style="color: ${healthColor}">
                    ${player.health > 0 ? Math.round(distance) + 'm' : 'ì‚¬ë§'}
                </span>
            `;
            gamePlayersList.appendChild(playerItem);
        });
        
        if (nearestPlayer && nearestDistance < Infinity) {
            document.getElementById('nearestDistance').textContent = Math.round(nearestDistance);
            document.getElementById('targetName').textContent = nearestPlayer.name;
        } else {
            document.getElementById('nearestDistance').textContent = '-';
            document.getElementById('targetName').textContent = '-';
        }

        // ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸
        const alivePlayers = Array.from(gameState.players.values()).filter(p => p.health > 0).length;
        if (alivePlayers === 0 && gameState.health > 0) {
            endGame('ìŠ¹ë¦¬!', 'ğŸ† ì¶•í•˜í•©ë‹ˆë‹¤! ì¹˜í‚¨ì„ íšë“í–ˆìŠµë‹ˆë‹¤!');
        }
    }

    // ê±°ë¦¬ ê³„ì‚° (í•˜ë²„ì‚¬ì¸ ê³µì‹)
    function calculateDistance(pos1, pos2) {
        const R = 6371000; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
        const dLat = (pos2.lat - pos1.lat) * Math.PI / 180;
        const dLon = (pos2.lng - pos1.lng) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(pos1.lat * Math.PI / 180) * Math.cos(pos2.lat * Math.PI / 180) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }

    // ë ˆì´ë” ì—…ë°ì´íŠ¸
    function updateRadar() {
        const radar = document.getElementById('radar');
        const dots = radar.querySelectorAll('.radar-dot');
        dots.forEach(dot => dot.remove());
        
        gameState.players.forEach(player => {
            if (player.health <= 0) return; // ì‚¬ë§í•œ í”Œë ˆì´ì–´ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
            
            const distance = calculateDistance(gameState.position, player.position);
            if (distance < 200) { // 200m ì´ë‚´ë§Œ í‘œì‹œ
                const dot = document.createElement('div');
                dot.className = 'radar-dot';
                
                // ë°©í–¥ ê³„ì‚°
                const bearing = calculateBearing(gameState.position, player.position);
                const radarDistance = Math.min(distance / 200 * 40, 40); // ë ˆì´ë” ë°˜ì§€ë¦„ì˜ 40% ë‚´ì—ì„œ í‘œì‹œ
                
                const x = 50 + radarDistance * Math.cos((bearing - 90) * Math.PI / 180);
                const y = 50 + radarDistance * Math.sin((bearing - 90) * Math.PI / 180);
                
                dot.style.left = x + '%';
                dot.style.top = y + '%';
                
                // ê±°ë¦¬ì— ë”°ë¼ ìƒ‰ìƒ ì¡°ì •
                const intensity = 1 - (distance / 200);
                dot.style.background = `rgba(255, 68, 68, ${intensity})`;
                dot.style.boxShadow = `0 0 ${8 * intensity}px rgba(255, 68, 68, ${intensity})`;
                
                radar.appendChild(dot);
            }
        });
    }

    // ë°©ìœ„ê° ê³„ì‚°
    function calculateBearing(pos1, pos2) {
        const dLon = (pos2.lng - pos1.lng) * Math.PI / 180;
        const lat1 = pos1.lat * Math.PI / 180;
        const lat2 = pos2.lat * Math.PI / 180;
        
        const y = Math.sin(dLon) * Math.cos(lat2);
        const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
        
        const bearing = Math.atan2(y, x) * 180 / Math.PI;
        return (bearing + 360) % 360;
    }

    // ë°œì‚¬ ì‹œì‘
    function startShooting(event) {
        if (event) event.preventDefault();
        
        if (gameState.screen !== 'game' || gameState.ammo <= 0 || gameState.isReloading || gameState.health <= 0) {
            return;
        }
        
        const now = Date.now();
        if (now - gameState.lastShot < 200) { // ë°œì‚¬ ì†ë„ ì œí•œ (200ms)
            return;
        }
        
        gameState.lastShot = now;
        gameState.ammo--;
        
        // ë°œì‚¬ íš¨ê³¼
        const shootBtn = document.getElementById('shootButton');
        shootBtn.style.transform = 'scale(0.9)';
        shootBtn.style.boxShadow = '0 0 30px rgba(255, 68, 68, 1)';
        
        // ì§„ë™ íš¨ê³¼
        if (navigator.vibrate) {
            navigator.vibrate(50);
        }
        
        // ëª…ì¤‘ íŒì •
        const hitResult = checkHit();
        
        // ë°œì‚¬ ì •ë³´ë¥¼ ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì—ê²Œ ì „ì†¡
        broadcastMessage({
            type: 'shot',
            data: {
                shooterId: gameState.playerId,
                shooterName: gameState.playerName,
                position: gameState.position,
                orientation: gameState.orientation,
                timestamp: now,
                hitResult: hitResult
            }
        });
        
        updateGameUI();
        
        // íƒ„ì•½ ë¶€ì¡± ì‹œ ìë™ ì¬ì¥ì „
        if (gameState.ammo <= 0) {
            setTimeout(reload, 500);
        }
    }

    // ë°œì‚¬ ì¢…ë£Œ
    function stopShooting(event) {
        if (event) event.preventDefault();
        
        const shootBtn = document.getElementById('shootButton');
        shootBtn.style.transform = 'scale(1)';
        shootBtn.style.boxShadow = '0 0 20px rgba(255, 68, 68, 0.5)';
    }

    // ëª…ì¤‘ íŒì •
    function checkHit() {
        let nearestPlayer = null;
        let nearestDistance = Infinity;
        
        // ì‚´ì•„ìˆëŠ” í”Œë ˆì´ì–´ ì¤‘ ê°€ì¥ ê°€ê¹Œìš´ í”Œë ˆì´ì–´ ì°¾ê¸°
        gameState.players.forEach(player => {
            if (player.health <= 0) return;
            
            const distance = calculateDistance(gameState.position, player.position);
            if (distance < nearestDistance) {
                nearestDistance = distance;
                nearestPlayer = player;
            }
        });
        
        if (nearestPlayer && nearestDistance < 100) { // 100m ì´ë‚´ì—ì„œë§Œ ëª…ì¤‘ ê°€ëŠ¥
            // ì¡°ì¤€ ì •í™•ë„ ê³„ì‚° (ê±°ë¦¬ ê¸°ë°˜)
            const accuracy = Math.max(0, 1 - (nearestDistance / 100));
            const hitChance = accuracy * 0.6 + 0.2; // 20-80% ëª…ì¤‘ë¥ 
            
            if (Math.random() < hitChance) {
                // ëª…ì¤‘!
                const damage = Math.floor(Math.random() * 25) + 25; // 25-50 ë°ë¯¸ì§€
                nearestPlayer.health = Math.max(0, nearestPlayer.health - damage);
                
                // í”¼í•´ ì •ë³´ë¥¼ í•´ë‹¹ í”Œë ˆì´ì–´ì—ê²Œ ì „ì†¡
                sendPeerMessage(nearestPlayer.id, {
                    type: 'hit',
                    data: {
                        damage: damage,
                        shooterId: gameState.playerId,
                        shooterName: gameState.playerName,
                        remainingHealth: nearestPlayer.health
                    }
                });
                
                if (nearestPlayer.health <= 0) {
                    // í”Œë ˆì´ì–´ ì œê±°
                    gameState.kills++;
                    showHitMarker(`${nearestPlayer.name} ì œê±°! (+1 í‚¬)`);
                    
                    // ì‚¬ë§ ì•Œë¦¼ ì „ì†¡
                    broadcastMessage({
                        type: 'death',
                        data: {
                            playerId: nearestPlayer.id,
                            playerName: nearestPlayer.name,
                            killerId: gameState.playerId,
                            killerName: gameState.playerName
                        }
                    });
                    
                } else {
                    showHitMarker(`${nearestPlayer.name} ì ì¤‘! (-${damage}HP)`);
                }
                
                return { hit: true, target: nearestPlayer.name, damage: damage };
            } else {
                showHitMarker('ë¹—ë‚˜ê°');
                return { hit: false, target: nearestPlayer.name };
            }
        } else {
            showHitMarker('ì‚¬ì •ê±°ë¦¬ ë°–');
            return { hit: false, target: null };
        }
    }

    // ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ë°œì‚¬ ì²˜ë¦¬
    function handlePeerShot(data, peerId) {
        // ì‹œê°ì /ì²­ê°ì  íš¨ê³¼ (ì´ì†Œë¦¬, ì´êµ¬ ì„¬ê´‘ ë“±)
        console.log(`${data.shooterName}ì´ ë°œì‚¬í–ˆìŠµë‹ˆë‹¤`);
        
        // ê±°ë¦¬ ê¸°ë°˜ ì´ì†Œë¦¬ ë³¼ë¥¨ ì¡°ì ˆ ë“±ì˜ íš¨ê³¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
    }

    // í”¼ê²© ì²˜ë¦¬
    function handlePeerHit(data) {
        gameState.health = Math.max(0, data.remainingHealth);
        showHitMarker(`${data.shooterName}ì—ê²Œ í”¼ê²©! (-${data.damage}HP)`);
        showHitEffect();
        
        if (gameState.health <= 0) {
            endGame('íŒ¨ë°°', `${data.shooterName}ì—ê²Œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }
        
        updateGameUI();
    }

    // í”Œë ˆì´ì–´ ì‚¬ë§ ì²˜ë¦¬
    function handlePlayerDeath(data, peerId) {
        const player = gameState.players.get(peerId);
        if (player) {
            player.health = 0;
            showHitMarker(`${data.playerName}ì´ ${data.killerName}ì—ê²Œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤`);
        }
    }

    // ëª…ì¤‘ í‘œì‹œ
    function showHitMarker(message) {
        const marker = document.createElement('div');
        marker.style.cssText = `
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #00ff41;
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid #00ff41;
            font-size: 16px;
            font-weight: bold;
            z-index: 180;
            pointer-events: none;
            animation: hitMarkerFade 2s ease-out forwards;
        `;
        marker.textContent = message;
        document.body.appendChild(marker);
        
        setTimeout(() => {
            marker.remove();
        }, 2000);
    }

    // í”¼ê²© íš¨ê³¼
    function showHitEffect() {
        const effect = document.createElement('div');
        effect.className = 'hit-effect';
        document.body.appendChild(effect);
        
        setTimeout(() => {
            effect.remove();
        }, 500);
        
        // ì§„ë™
        if (navigator.vibrate) {
            navigator.vibrate([200, 100, 200]);
        }
    }

    // ì¬ì¥ì „
    function reload() {
        if (gameState.isReloading || gameState.ammo === gameState.maxAmmo || gameState.health <= 0) return;
        
        gameState.isReloading = true;
        showHitMarker('ì¬ì¥ì „ ì¤‘...');
        
        setTimeout(() => {
            gameState.ammo = gameState.maxAmmo;
            gameState.isReloading = false;
            showHitMarker('ì¬ì¥ì „ ì™„ë£Œ!');
            updateGameUI();
        }, 2500);
    }

    // ê²Œì„ ì¢…ë£Œ
    function endGame(title, message) {
        if (gameState.gameLoop) {
            clearInterval(gameState.gameLoop);
            gameState.gameLoop = null;
        }
        if (gameState.pingInterval) {
            clearInterval(gameState.pingInterval);
            gameState.pingInterval = null;
        }
        
        showStatus(title, message);
    }

    // ê²Œì„ ë‚˜ê°€ê¸°
    function leaveGame() {
        if (gameState.gameLoop) {
            clearInterval(gameState.gameLoop);
            gameState.gameLoop = null;
        }
        if (gameState.pingInterval) {
            clearInterval(gameState.pingInterval);
            gameState.pingInterval = null;
        }
        
        // P2P ì—°ê²° ì •ë¦¬
        gameState.connections.forEach((connection, peerId) => {
            if (connection.peerConnection) {
                connection.peerConnection.close();
            }
        });
        gameState.connections.clear();
        gameState.players.clear();
        
        // ì‹œê·¸ë„ë§ ì„œë²„ì— ë‚˜ê°€ê¸° ì•Œë¦¼
        sendSignalingMessage({
            type: 'leave-game',
            roomCode: gameState.roomCode,
            playerId: gameState.playerId
        });
        
        showScreen('lobby');
    }

    // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateConnectionStatus(status) {
        const statusEl = document.getElementById('connectionStatus');
        statusEl.className = `connection-status ${status}`;
        
        switch (status) {
            case 'connected':
                statusEl.textContent = 'ğŸŸ¢ ì—°ê²°ë¨';
                break;
            case 'connecting':
                statusEl.textContent = 'ğŸŸ¡ ì—°ê²° ì¤‘...';
                break;
            case 'disconnected':
                statusEl.textContent = 'ğŸ”´ ì—°ê²° ëŠê¹€';
                break;
        }
    }

    // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
    function showStatus(title, message) {
        document.getElementById('statusTitle').textContent = title;
        document.getElementById('statusMessage').textContent = message;
        document.getElementById('statusOverlay').classList.remove('hidden');
    }

    // ìƒíƒœ ë©”ì‹œì§€ ë‹«ê¸°
    function closeStatus() {
        document.getElementById('statusOverlay').classList.add('hidden');
    }

    // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ë“¤
    function handlePlayerJoin(message) {
        console.log('í”Œë ˆì´ì–´ ì°¸ê°€:', message.playerName);
        // ê¸°ì¡´ í”Œë ˆì´ì–´ì¸ ê²½ìš° WebRTC ì—°ê²° ì‹œì‘
        if (gameState.isHost) {
            createOffer(message.playerId);
        }
    }

    function handleOffer(message) {
        if (message.targetId === gameState.playerId) {
            handleRemoteOffer(message);
        }
    }

    function handleAnswer(message) {
        if (message.targetId === gameState.playerId) {
            handleRemoteAnswer(message);
        }
    }

    function handleIceCandidate(message) {
        if (message.targetId === gameState.playerId) {
            handleRemoteIceCandidate(message);
        }
    }

    function handlePlayerLeave(message) {
        console.log('í”Œë ˆì´ì–´ ë‚˜ê°:', message.playerId);
        const connection = gameState.connections.get(message.playerId);
        if (connection) {
            connection.peerConnection.close();
            gameState.connections.delete(message.playerId);
        }
        gameState.players.delete(message.playerId);
        updateConnectedCount();
    }

    function handleGameStart(message) {
        if (!gameState.isHost) {
            initializeGame();
        }
    }

    // WebRTC Offer ìƒì„±
    async function createOffer(peerId) {
        try {
            const peerConnection = createPeerConnection(peerId);
            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            
            sendSignalingMessage({
                type: 'offer',
                roomCode: gameState.roomCode,
                senderId: gameState.playerId,
                targetId: peerId,
                offer: offer
            });
        } catch (error) {
            console.error('Offer ìƒì„± ì‹¤íŒ¨:', error);
        }
    }

    // WebRTC Offer ì²˜ë¦¬
    async function handleRemoteOffer(message) {
        try {
            const peerConnection = createPeerConnection(message.senderId);
            await peerConnection.setRemoteDescription(new RTCSessionDescription(message.offer));
            
            const answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
            
            sendSignalingMessage({
                type: 'answer',
                roomCode: gameState.roomCode,
                senderId: gameState.playerId,
                targetId: message.senderId,
                answer: answer
            });
        } catch (error) {
            console.error('Offer ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        }
    }

    // WebRTC Answer ì²˜ë¦¬
    async function handleRemoteAnswer(message) {
        try {
            const connection = gameState.connections.get(message.senderId);
            if (connection && connection.peerConnection) {
                await connection.peerConnection.setRemoteDescription(new RTCSessionDescription(message.answer));
            }
        } catch (error) {
            console.error('Answer ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        }
    }

    // ICE Candidate ì²˜ë¦¬
    async function handleRemoteIceCandidate(message) {
        try {
            const connection = gameState.connections.get(message.senderId);
            if (connection && connection.peerConnection) {
                await connection.peerConnection.addIceCandidate(new RTCIceCandidate(message.candidate));
            }
        } catch (error) {
            console.error('ICE Candidate ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        }
    }

    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬í†±ì—ì„œ í…ŒìŠ¤íŠ¸ìš©)
    document.addEventListener('keydown', (event) => {
        if (gameState.screen === 'game') {
            switch (event.code) {
                case 'Space':
                    event.preventDefault();
                    startShooting();
                    setTimeout(stopShooting, 100);
                    break;
                case 'KeyR':
                    event.preventDefault();
                    reload();
                    break;
                case 'Escape':
                    event.preventDefault();
                    leaveGame();
                    break;
            }
        }
    });

    // í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ ê°œì„ 
    document.getElementById('shootButton').addEventListener('touchstart', (e) => {
        e.preventDefault();
        startShooting();
    });
    
    document.getElementById('shootButton').addEventListener('touchend', (e) => {
        e.preventDefault();
        stopShooting();
    });

    // ë°© ì½”ë“œ ì…ë ¥ì—ì„œ ì—”í„°í‚¤ ì²˜ë¦¬
    document.getElementById('roomCodeInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            joinRoom();
        }
    });

    // ë°©í–¥ ë³€í™” ê°ì§€ (í™”ë©´ íšŒì „ ë°©ì§€)
    window.addEventListener('orientationchange', () => {
        setTimeout(() => {
            window.scrollTo(0, 1);
        }, 100);
    });

    // í™”ë©´ êº¼ì§ ë°©ì§€
    let wakeLock = null;
    async function requestWakeLock() {
        try {
            if ('wakeLock' in navigator) {
                wakeLock = await navigator.wakeLock.request('screen');
            }
        } catch (err) {
            console.log('í™”ë©´ ìœ ì§€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', err);
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
        init();
        
        // ê²Œì„ ì‹œì‘ì‹œ í™”ë©´ ìœ ì§€ ìš”ì²­
        document.addEventListener('click', requestWakeLock, { once: true });
    });

    // í˜ì´ì§€ ë²—ì–´ë‚  ë•Œ ì •ë¦¬
    window.addEventListener('beforeunload', () => {
        if (wakeLock) {
            wakeLock.release();
        }
        
        // ëª¨ë“  ì—°ê²° ì •ë¦¬
        gameState.connections.forEach((connection) => {
            if (connection.peerConnection) {
                connection.peerConnection.close();
            }
        });
        
        if (gameState.signaling) {
            gameState.signaling.close();
        }
        
        if (gameState.gameLoop) {
            clearInterval(gameState.gameLoop);
        }
        
        if (gameState.pingInterval) {
            clearInterval(gameState.pingInterval);
        }
    });

    // ë°ëª¨ìš© AI ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ í”Œë ˆì´ì–´ê°€ ì—†ì„ ë•Œ)
    function addDemoPlayers() {
        if (gameState.connections.size === 0 && gameState.screen === 'game') {
            // ê°€ìƒì˜ í”Œë ˆì´ì–´ë“¤ ìƒì„±
            for (let i = 1; i <= 2; i++) {
                const virtualPlayer = {
                    id: `demo_player_${i}`,
                    name: generateRandomName(),
                    health: 100,
                    position: {
                        lat: gameState.position.lat + (Math.random() - 0.5) * 0.002,
                        lng: gameState.position.lng + (Math.random() - 0.5) * 0.002
                    },
                    lastSeen: Date.now()
                };
                gameState.players.set(virtualPlayer.id, virtualPlayer);
            }
            
            updateGameUI();
        }
    }

    // ë°ëª¨ AI í–‰ë™
    function simulateDemoAI() {
        if (gameState.screen !== 'game' || gameState.connections.size > 0) return;
        
        gameState.players.forEach((player, id) => {
            if (id.startsWith('demo_player_') && player.health > 0) {
                // ëœë¤ ì´ë™
                player.position.lat += (Math.random() - 0.5) * 0.0001;
                player.position.lng += (Math.random() - 0.5) * 0.0001;
                
                // ê°€ë” í”Œë ˆì´ì–´ì—ê²Œ í”¼í•´ë¥¼ ì¤Œ
                if (Math.random() < 0.005) { // 0.5% í™•ë¥ 
                    const distance = calculateDistance(gameState.position, player.position);
                    if (distance < 50 && gameState.health > 0) { // 50m ì´ë‚´
                        const damage = Math.floor(Math.random() * 20 + 10);
                        gameState.health = Math.max(0, gameState.health - damage);
                        showHitMarker(`${player.name}ì—ê²Œ í”¼ê²©! (-${damage}HP)`);
                        showHitEffect();
                        
                        if (gameState.health <= 0) {
                            endGame('íŒ¨ë°°', `${player.name}ì—ê²Œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                        }
                        updateGameUI();
                    }
                }
            }
        });
    }

    // ë°ëª¨ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
    setInterval(() => {
        addDemoPlayers();
        simulateDemoAI();
    }, 100);

    // ì‹¤ì œ ì‹œê·¸ë„ë§ ì„œë²„ êµ¬í˜„ ì˜ˆì œ (Firebase ì‚¬ìš© ì‹œ)
    /*
    function initFirebaseSignaling() {
        // Firebase êµ¬ì„±
        const firebaseConfig = {
            // Firebase í”„ë¡œì íŠ¸ ì„¤ì •
        };
        
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // ë°© ìƒì„±/ì°¸ê°€
        function createFirebaseRoom() {
            const roomRef = database.ref('rooms/' + gameState.roomCode);
            roomRef.set({
                host: gameState.playerId,
                created: Date.now(),
                players: {
                    [gameState.playerId]: {
                        name: gameState.playerName,
                        isHost: true,
                        lastSeen: Date.now()
                    }
                }
            });
            
            // í”Œë ˆì´ì–´ ì°¸ê°€ ê°ì§€
            roomRef.child('players').on('child_added', (snapshot) => {
                const playerId = snapshot.key;
                const playerData = snapshot.val();
                
                if (playerId !== gameState.playerId) {
                    console.log('ìƒˆ í”Œë ˆì´ì–´ ì°¸ê°€:', playerData.name);
                    if (gameState.isHost) {
                        createOffer(playerId);
                    }
                }
            });
        }
        
        function joinFirebaseRoom() {
            const roomRef = database.ref('rooms/' + gameState.roomCode);
            roomRef.child('players/' + gameState.playerId).set({
                name: gameState.playerName,
                isHost: false,
                lastSeen: Date.now()
            });
            
            // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì²˜ë¦¬
            roomRef.child('signals').on('child_added', (snapshot) => {
                const signal = snapshot.val();
                if (signal.targetId === gameState.playerId) {
                    handleSignalingMessage(signal);
                    // ë©”ì‹œì§€ ì‚­ì œ
                    snapshot.ref.remove();
                }
            });
        }
        
        function sendFirebaseSignal(message) {
            const roomRef = database.ref('rooms/' + gameState.roomCode + '/signals');
            roomRef.push(message);
        }
    }
    */

    // Socket.io ì‹œê·¸ë„ë§ ì„œë²„ êµ¬í˜„ ì˜ˆì œ
    /*
    function initSocketSignaling() {
        const socket = io('https://your-signaling-server.com');
        
        socket.on('connect', () => {
            console.log('ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²°ë¨');
            updateConnectionStatus('connected');
        });
        
        socket.on('disconnect', () => {
            console.log('ì‹œê·¸ë„ë§ ì„œë²„ ì—°ê²° ëŠê¹€');
            updateConnectionStatus('disconnected');
        });
        
        socket.on('room-created', (data) => {
            console.log('ë°© ìƒì„±ë¨:', data.roomCode);
        });
        
        socket.on('player-joined', (data) => {
            console.log('í”Œë ˆì´ì–´ ì°¸ê°€:', data.playerName);
            if (gameState.isHost) {
                createOffer(data.playerId);
            }
        });
        
        socket.on('signal', (data) => {
            handleSignalingMessage(data);
        });
        
        // ë°© ìƒì„±
        function createSocketRoom() {
            socket.emit('create-room', {
                roomCode: gameState.roomCode,
                playerId: gameState.playerId,
                playerName: gameState.playerName
            });
        }
        
        // ë°© ì°¸ê°€
        function joinSocketRoom() {
            socket.emit('join-room', {
                roomCode: gameState.roomCode,
                playerId: gameState.playerId,
                playerName: gameState.playerName
            });
        }
        
        // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì „ì†¡
        function sendSocketSignal(message) {
            socket.emit('signal', message);
        }
    }
    */

    // PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸
    const manifest = {
        name: "PUBG AR - ì‹¤ì‹œê°„ ë°°í‹€ë¡œì–„",
        short_name: "PUBG AR",
        description: "ì‹¤ì‹œê°„ P2P ë©€í‹°í”Œë ˆì´ì–´ ì¦ê°•í˜„ì‹¤ ë°°í‹€ë¡œì–„ ê²Œì„",
        start_url: "/",
        display: "standalone",
        background_color: "#1a1a2e",
        theme_color: "#00ff41",
        orientation: "portrait",
        icons: [
            {
                src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjMWExYTJlIi8+Cjx0ZXh0IHg9Ijk2IiB5PSIxMTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI2MCIgZmlsbD0iIzAwZmY0MSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+OvzwvdGV4dD4KPC9zdmc+",
                sizes: "192x192",
                type: "image/svg+xml"
            }
        ]
    };

    // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            const swCode = `
                const CACHE_NAME = 'pubg-ar-multiplayer-v1';
                const urlsToCache = [
                    '/',
                    '/manifest.json'
                ];
                
                self.addEventListener('install', (event) => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then((cache) => cache.addAll(urlsToCache))
                    );
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request)
                            .then((response) => {
                                // ìºì‹œëœ ë²„ì „ì´ ìˆìœ¼ë©´ ë°˜í™˜, ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                                return response || fetch(event.request);
                            })
                    );
                });
                
                // í‘¸ì‹œ ì•Œë¦¼ ì²˜ë¦¬ (ì„ íƒì‚¬í•­)
                self.addEventListener('push', (event) => {
                    const options = {
                        body: event.data ? event.data.text() : 'ìƒˆë¡œìš´ ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!',
                        icon: '/icon-192x192.png',
                        badge: '/badge-72x72.png',
                        vibrate: [100, 50, 100],
                        data: {
                            dateOfArrival: Date.now(),
                            primaryKey: '1'
                        }
                    };
                    
                    event.waitUntil(
                        self.registration.showNotification('PUBG AR', options)
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then((registration) => {
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì™„ë£Œ:', registration.scope);
                })
                .catch((error) => {
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:', error);
                });
        });
    }

    // ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë™ì  ìƒì„±
    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const manifestUrl = URL.createObjectURL(manifestBlob);
    const link = document.createElement('link');
    link.rel = 'manifest';
    link.href = manifestUrl;
    document.head.appendChild(link);

    // ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ (ê°œë°œìš©)
    function showDebugInfo() {
        if (gameState.screen === 'game') {
            console.log('=== ê²Œì„ ìƒíƒœ ===');
            console.log('í”Œë ˆì´ì–´ ìˆ˜:', gameState.players.size);
            console.log('ì—°ê²° ìˆ˜:', gameState.connections.size);
            console.log('ìœ„ì¹˜:', gameState.position);
            console.log('ì²´ë ¥:', gameState.health);
            console.log('íƒ„ì•½:', gameState.ammo);
            console.log('=================');
        }
    }

    // ë””ë²„ê·¸ ì •ë³´ ì£¼ê¸°ì  ì¶œë ¥ (ê°œë°œìš©)
    setInterval(showDebugInfo, 10000);

    // ì—°ê²° í’ˆì§ˆ ëª¨ë‹ˆí„°ë§
    function monitorConnectionQuality() {
        gameState.connections.forEach((connection, peerId) => {
            if (connection.peerConnection) {
                connection.peerConnection.getStats().then(stats => {
                    stats.forEach(report => {
                        if (report.type === 'data-channel') {
                            console.log(`${peerId} ë°ì´í„° ì±„ë„ í†µê³„:`, {
                                bytesReceived: report.bytesReceived,
                                bytesSent: report.bytesSent,
                                messagesReceived: report.messagesReceived,
                                messagesSent: report.messagesSent
                            });
                        }
                    });
                }).catch(console.error);
            }
        });
    }

    // ì—°ê²° í’ˆì§ˆ ëª¨ë‹ˆí„°ë§ ì‹œì‘ (5ì´ˆë§ˆë‹¤)
    setInterval(monitorConnectionQuality, 5000);

    // ì•± ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        // ê¸°ë³¸ ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ë°©ì§€
        e.preventDefault();
        // ë‚˜ì¤‘ì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´ë²¤íŠ¸ ì €ì¥
        deferredPrompt = e;
        
        // ì‚¬ìš©ìì—ê²Œ ì•± ì„¤ì¹˜ ì˜µì…˜ í‘œì‹œ
        showInstallButton();
    });

    function showInstallButton() {
        // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ ë¡œì§
        const installBtn = document.createElement('button');
        installBtn.textContent = 'ğŸ“± ì•± ì„¤ì¹˜';
        installBtn.className = 'btn btn-info';
        installBtn.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 200;';
        installBtn.onclick = installApp;
        document.body.appendChild(installBtn);
    }

    function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ì— ë™ì˜í–ˆìŠµë‹ˆë‹¤');
                }
                deferredPrompt = null;
            });
        }
    }

    // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
    function updateNetworkStatus() {
        const isOnline = navigator.onLine;
        const statusEl = document.getElementById('connectionStatus');
        
        if (!isOnline) {
            statusEl.textContent = 'ğŸ”´ ì˜¤í”„ë¼ì¸';
            statusEl.className = 'connection-status disconnected';
        }
    }

    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);

    // ì„±ëŠ¥ ìµœì í™”: requestAnimationFrameì„ ì´ìš©í•œ ë¶€ë“œëŸ¬ìš´ ì—…ë°ì´íŠ¸
    let lastFrameTime = 0;
    function gameRenderLoop(currentTime) {
        const deltaTime = currentTime - lastFrameTime;
        
        if (gameState.screen === 'game' && deltaTime >= 16) { // 60fps ì œí•œ
            updateRadar();
            lastFrameTime = currentTime;
        }
        
        requestAnimationFrame(gameRenderLoop);
    }
    
    // ë Œë”ë§ ë£¨í”„ ì‹œì‘
    requestAnimationFrame(gameRenderLoop);

    console.log('ğŸ® PUBG AR ë©€í‹°í”Œë ˆì´ì–´ ë¡œë“œ ì™„ë£Œ!');
    console.log('ğŸ“± ì‹¤ì œ ë©€í‹°í”Œë ˆì´ì–´ë¥¼ ìœ„í•´ì„œëŠ” ì‹œê·¸ë„ë§ ì„œë²„ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
    console.log('ğŸ”§ Firebase, Socket.io, ë˜ëŠ” WebSocket ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.');
</script>
```

</body>
</html>
